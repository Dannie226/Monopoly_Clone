import*as e from"three";import{GLTFLoader as t}from"three/examples/jsm/loaders/GLTFLoader";import{RGBELoader as o}from"three/examples/jsm/loaders/RGBELoader";import*as a from"../libs/tween";import{GUI as r}from"dat.gui";import{Player as n}from"./logic/Player";import{Globals as i}from"./logic/Globals";import{Dice as l}from"./logic/Dice";const{innerWidth:s,innerHeight:d}=window,m=new e.WebGLRenderer,c=(m.setSize(s,d),m.setClearColor(12571109),document.body.appendChild(m.domElement),new e.Scene),u=new e.PerspectiveCamera(75,s/d,100,3e3),_=(u.position.y=1e3,u.position.x=2e3,i.camera=u,new e.DirectionalLight),w=(c.add(_),new e.PMREMGenerator(m)),h=new e.LoadingManager,b=new t(h),p={tokens:{hat:null,iron:null,barrow:null,thimble:null},board:null},g=new r,f=(b.load("../die.glb",e=>{l.init();const t=e.scene.getObjectByName("Box001_Material_#25_0");t.geometry.center(),c.add(l.createDie(t).getMesh()),c.add(l.createDie().getMesh())}),b.load("../board.glb",e=>{const t=[];for(const o of["Top_Hat_09_-_Default_0","Iron_09_-_Default_0","Wheel_Barrow_09_-_Default_0","Thimble_09_-_Default_0"]){const a=e.scene.getObjectByName(o);a.geometry.rotateX(-Math.PI/2),a.geometry.rotateY(Math.PI/2),c.add(a),t.push(a)}p.tokens.hat=t[0],p.tokens.iron=t[1],p.tokens.barrow=t[2],p.tokens.thimble=t[3],p.tokens.barrow.visible=p.tokens.thimble.visible=!1,u.position.set(0,975,0),u.quaternion.set(-Math.SQRT1_2,0,0,Math.SQRT1_2),p.board=e.scene.getObjectByName("Board_01_-_Default_0"),p.board.geometry.rotateX(-Math.PI/2),p.board.position.z=-10,c.add(p.board)}),h.onLoad=async function(){const t=new n(null,"Daniel",p.tokens.iron),o=new n(null,"Nate",p.tokens.hat);for(let e=0;e<5;e++)await t.moveForward(await l.rollDice()),await y(500),await o.moveForward(await l.rollDice()),await y(500)},new o);function D(){a.update(),l.update(),m.render(c,u),requestAnimationFrame(D)}function y(t){return new Promise(e=>{setTimeout(e,t)})}f.load("https://threejs.org/examples/textures/equirectangular/pedestrian_overpass_1k.hdr",function(e){c.environment=w.fromEquirectangular(e).texture}),D();