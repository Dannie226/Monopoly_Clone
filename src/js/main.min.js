import*as n from"three";import{GLTFLoader as e}from"three/examples/jsm/loaders/GLTFLoader";import{RGBELoader as t}from"three/examples/jsm/loaders/RGBELoader";import*as o from"../libs/tween";import{Globals as s}from"./logic/Globals";import{Dice as a}from"./logic/Dice";const{innerWidth:r,innerHeight:i}=window,l=new n.WebGLRenderer,d=(l.setSize(r,i),l.setClearColor(12571109),document.body.appendChild(l.domElement),new n.Scene),m=new n.PerspectiveCamera(75,r/i,100,3e3),c=(m.position.y=1e3,m.position.x=2e3,s.camera=m,new n.DirectionalLight),h=(d.add(c),new n.PMREMGenerator(l)),_=new n.LoadingManager,u=new e(_),b={tokens:{hat:null,iron:null,barrow:null,thimble:null},board:null},g=(u.load("../resources/models/die.glb",e=>{a.init();const t=e.scene.getObjectByName("Box001_Material_#25_0");t.geometry.center(),d.add(a.createDie(t).getMesh()),d.add(a.createDie().getMesh())}),u.load("../resources/models/board.glb",e=>{const t=[];for(const a of["Top_Hat_09_-_Default_0","Iron_09_-_Default_0","Wheel_Barrow_09_-_Default_0","Thimble_09_-_Default_0"]){const r=e.scene.getObjectByName(a);r.geometry.rotateX(-Math.PI/2),r.geometry.rotateY(Math.PI/2),d.add(r),t.push(r)}b.tokens.hat=t[0],b.tokens.iron=t[1],b.tokens.barrow=t[2],b.tokens.thimble=t[3],b.tokens.barrow.visible=b.tokens.thimble.visible=!1,m.position.set(0,975,0),m.quaternion.set(-Math.SQRT1_2,0,0,Math.SQRT1_2),b.board=e.scene.getObjectByName("Board_01_-_Default_0"),b.board.geometry.rotateX(-Math.PI/2),b.board.position.y=-5,d.add(b.board);const o=e.scene.getObjectByName("House_07_-_Default_0");o.geometry.rotateX(-Math.PI/2),o.geometry.scale(1/3,1/3,1/3),s.houseMesh=new n.InstancedMesh(o.geometry,o.material,112),s.houseMesh.instanceMatrix.setUsage(n.DynamicDrawUsage),d.add(s.houseMesh)}),_.onLoad=async function(){},new t);function p(){o.update(),a.update(),l.render(d,m),requestAnimationFrame(p)}g.load("https://threejs.org/examples/textures/equirectangular/pedestrian_overpass_1k.hdr",function(e){d.environment=h.fromEquirectangular(e).texture}),p();