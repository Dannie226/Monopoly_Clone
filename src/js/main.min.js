import*as n from"three";import{GLTFLoader as e}from"three/examples/jsm/loaders/GLTFLoader";import{OrbitControls as t}from"three/examples/jsm/controls/OrbitControls";import{RGBELoader as o}from"three/examples/jsm/loaders/RGBELoader";import*as a from"../libs/tween";import{GUI as r}from"dat.gui";import{Player as s}from"./logic/Player";import{Globals as i}from"./logic/Globals";import{Dice as l}from"./logic/Dice";import{Property as m}from"./logic/Property";const{innerWidth:d,innerHeight:c}=window,u=new n.WebGLRenderer,h=(u.setSize(d,c),u.setClearColor(12571109),document.body.appendChild(u.domElement),new n.Scene),_=new n.PerspectiveCamera(75,d/c,100,3e3),g=(_.position.y=1e3,_.position.x=2e3,i.camera=_,new n.DirectionalLight),p=(h.add(g),new n.PMREMGenerator(u)),b=new n.LoadingManager,f=new e(b),w={tokens:{hat:null,iron:null,barrow:null,thimble:null},board:null},y=new r,M=new t(_,u.domElement),D=(f.load("../die.glb",e=>{l.init();const t=e.scene.getObjectByName("Box001_Material_#25_0");t.geometry.center(),h.add(l.createDie(t).getMesh()),h.add(l.createDie().getMesh())}),f.load("../board.glb",e=>{const t=[];console.log(e);for(const a of["Top_Hat_09_-_Default_0","Iron_09_-_Default_0","Wheel_Barrow_09_-_Default_0","Thimble_09_-_Default_0"]){const r=e.scene.getObjectByName(a);r.geometry.rotateX(-Math.PI/2),r.geometry.rotateY(Math.PI/2),h.add(r),t.push(r)}w.tokens.hat=t[0],w.tokens.iron=t[1],w.tokens.barrow=t[2],w.tokens.thimble=t[3],w.tokens.barrow.visible=w.tokens.thimble.visible=!1,_.position.set(0,975,0),_.quaternion.set(-Math.SQRT1_2,0,0,Math.SQRT1_2),w.board=e.scene.getObjectByName("Board_01_-_Default_0"),w.board.geometry.rotateX(-Math.PI/2),w.board.position.y=-5,h.add(w.board);const o=e.scene.getObjectByName("House_07_-_Default_0");o.geometry.rotateX(-Math.PI/2),o.geometry.scale(1/3,1/3,1/3),i.houseMesh=new n.InstancedMesh(o.geometry,o.material,112),i.houseMesh.instanceMatrix.setUsage(n.DynamicDrawUsage),h.add(i.houseMesh)}),b.onLoad=async function(){const e=new s(0,"Daniel",w.tokens.iron);e.money=1/0;for(const t of i.tiles)t instanceof m&&(t.owner=e,t.addHouse(),await L(125),t.addHouse(),await L(125),t.addHouse(),await L(125),t.addHouse(),await L(125))},new o);function P(){a.update(),l.update(),u.render(h,_),requestAnimationFrame(P)}function L(t){return new Promise(e=>{setTimeout(e,t)})}D.load("https://threejs.org/examples/textures/equirectangular/pedestrian_overpass_1k.hdr",function(e){h.environment=p.fromEquirectangular(e).texture}),P();